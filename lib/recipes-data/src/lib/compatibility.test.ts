import { convertToRecipeV2 } from './compatibility';
import { calculateChecksum } from './utils';

// prettier-ignore
const raw_json_content_v2 = `{"bookCredit":"Alice Staple is an executive chef and co-founder of Maremma, London","canonicalArticle":"food/2019/jan/23/alice-staple-recipe-risotto-ai-funghi-porcini","celebrationIds":[],"composerId":"5c45c777e4b0e54e3177edf4","contributors":[],"cuisineIds":["italian"],"description":"Fresh porcini adds such a great quality and taste but the dried ones variety are a good substitute and the water used to rehydrate them makes a delicious stock. I love this recipe because it’s is a real crowd pleaser and it’s easily adaptable for vegans","difficultyLevel":"easy","featuredImage":{"url":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=1600&dpr=1&s=none","mediaId":"b9c696f5d94a3a6ab1320fc41af10f9037ce5a48","cropId":"","source":"PR","photographer":"","caption":"Alice Staple’s mushroom risotto.","mediaApiUri":"","width":2000,"height":1200,"templateUrl":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=#{width}&quality=#{quality}&dpr=1&s=none"},"id":"25db0711ef5e458c996a480b866a04fc","ingredients":[{"ingredientsList":[{"amount":{"max":25,"min":25},"name":"dried porcini mushrooms","optional":false,"text":"25 g dried porcini mushrooms","unit":"g"},{"amount":{"max":150,"min":150},"name":"chestnut","optional":false,"suffix":"or field mushrooms, roughly chopped","text":"150 g chestnut or field mushrooms, roughly chopped","unit":"g"},{"amount":{"max":150,"min":150},"name":"oyster mushrooms","optional":false,"suffix":"roughly chopped","text":"150 g oyster mushrooms, roughly chopped","unit":"g"},{"amount":{"max":4,"min":4},"name":"olive oil","optional":false,"text":"4 tbsp olive oil","unit":"tbsp"},{"amount":{"max":1,"min":1},"name":"sized onion","optional":false,"prefix":"medium","suffix":"finely chopped","text":"1 medium sized onion, finely chopped"},{"amount":{"min":2,"max":2},"name":"garlic cloves","optional":false,"suffix":"minced","text":"2 cloves of garlic, minced"},{"amount":{"max":200,"min":200},"name":"arborio rice","optional":false,"text":"200 g arborio rice","unit":"g"},{"amount":{"max":250,"min":250},"name":"white wine","optional":false,"text":"250 ml white wine","unit":"ml"},{"amount":{"min":1,"max":1},"name":"chicken or vegetable stock","optional":false,"text":"1 litre of chicken or vegetable stock","unit":"litre"},{"amount":{"min":null,"max":null},"name":"Small bunch parsley","optional":false,"suffix":"leaves only and finely chopped","text":"Small bunch of parsley, leaves only and finely chopped"},{"amount":{"max":100,"min":100},"name":"butter","optional":false,"text":"100 g butter","unit":"g"},{"amount":{"max":100,"min":100},"name":"parmesan cheese","optional":false,"prefix":"grated","text":"100 g grated parmesan cheese","unit":"g"},{"name":"Truffle oil","optional":false,"suffix":"(optional)","text":"Truffle oil (optional)"}],"recipeSection":""}],"instructions":[{"description":"Soak the mushrooms in boiling water for 15-20 minutes. You need just enough water to cover the mushrooms."},{"description":"Roughly chop the chestnut and oyster mushrooms so they are 1-2cm cubed, or however chunky you prefer them."},{"description":"Fry in 1 tbsp olive oil and a knob of butter until golden brown. Set to one side until you’re ready to add them to the risotto."},{"description":"Fry the finely chopped onion in three tbsp of olive oil for about five minutes on a medium heat until soft but not browned."},{"description":"Add the garlic and fry for another minute."},{"description":"Add the rice and mix until nicely coated with the oil, onions and garlic."},{"description":"Add the wine, turn the heat up and stir continuously."},{"description":"Cook until fully absorbed and turn the heat back down to medium."},{"description":"Add the porcini water and stir again until fully absorbed."},{"description":"Add enough stock to just cover the rice, stir and repeat the process for about 10 minutes."},{"description":"Add the mushrooms and cook with the rice for five minutes - it should have absorbed the majority of the liquid but not be completely dry."},{"description":"You have the option to add a bit more stock – the most important thing is that the rice still has a bit of a bite but isn’t too crunchy."},{"description":"Add a knob of butter, 75g of Parmesan, and the parsley. Stir together and check the consistency. It should be wet but not sitting in liquid. Allow it to sit for a minute or two before serving."},{"description":"Serve in shallow bowls or plates. For those who like it extra cheesy, sprinkle the remainder of the Parmesan on top. For something extra special drizzle over some truffle oil."},{"description":"Vegans can easily substitute the butter for oil (although there is no need to add extra oil at the end of the recipe) and you can leave the cheese out too."}],"isAppReady":false,"mealTypeIds":["easy","quick","midweek","dinner"],"serves":[],"suitableForDietIds":["meat-free","gluten-free","pescatarian"],"techniquesUsedIds":[],"timings":[{"durationInMins":{"max":20,"min":20},"qualifier":"prep-time","text":"Prep time: 20 mins"},{"durationInMins":{"max":30,"min":30},"qualifier":"cook-time","text":"Cook time: 30 mins"}],"title":"Risotto ai funghi porcini","utensilsAndApplianceIds":[],"byline":["Alice Staple"],"previewImage":{"url":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=1600&dpr=1&s=none","mediaId":"b9c696f5d94a3a6ab1320fc41af10f9037ce5a48","cropId":"","source":"PR","photographer":"","caption":"Alice Staple’s mushroom risotto.","mediaApiUri":"","width":2000,"height":1200,"templateUrl":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=#{width}&quality=#{quality}&dpr=1&s=none"},"lastModifiedDate":"2024-09-09T11:49:07.000Z","publishedDate":"2024-09-09T11:49:10.000Z"}`;
// prettier-ignore
const raw_json_content_v3 = `{"bookCredit":"Alice Staple is an executive chef and co-founder of Maremma, London","canonicalArticle":"food/2019/jan/23/alice-staple-recipe-risotto-ai-funghi-porcini","celebrationIds":[],"composerId":"5c45c777e4b0e54e3177edf4","contributors":[],"cuisineIds":["italian"],"description":"Fresh porcini adds such a great quality and taste but the dried ones variety are a good substitute and the water used to rehydrate them makes a delicious stock. I love this recipe because it’s is a real crowd pleaser and it’s easily adaptable for vegans","difficultyLevel":"easy","featuredImage":{"url":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=1600&dpr=1&s=none","mediaId":"b9c696f5d94a3a6ab1320fc41af10f9037ce5a48","cropId":"","source":"PR","photographer":"","caption":"Alice Staple’s mushroom risotto.","mediaApiUri":"","width":2000,"height":1200,"templateUrl":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=#{width}&quality=#{quality}&dpr=1&s=none"},"id":"25db0711ef5e458c996a480b866a04fc","ingredients":[{"ingredientsList":[{"amount":{"max":25,"min":25},"name":"dried porcini mushrooms","optional":false,"text":"25 g dried porcini mushrooms","unit":"g"},{"amount":{"max":150,"min":150},"name":"chestnut","optional":false,"suffix":"or field mushrooms, roughly chopped","text":"150 g chestnut or field mushrooms, roughly chopped","unit":"g"},{"amount":{"max":150,"min":150},"name":"oyster mushrooms","optional":false,"suffix":"roughly chopped","text":"150 g oyster mushrooms, roughly chopped","unit":"g"},{"amount":{"max":4,"min":4},"name":"olive oil","optional":false,"text":"4 tbsp olive oil","unit":"tbsp"},{"amount":{"max":1,"min":1},"name":"sized onion","optional":false,"prefix":"medium","suffix":"finely chopped","text":"1 medium sized onion, finely chopped"},{"amount":{"min":2,"max":2},"name":"garlic cloves","optional":false,"suffix":"minced","text":"2 cloves of garlic, minced"},{"amount":{"max":200,"min":200},"name":"arborio rice","optional":false,"text":"200 g arborio rice","unit":"g"},{"amount":{"max":250,"min":250},"name":"white wine","optional":false,"text":"250 ml white wine","unit":"ml"},{"amount":{"min":1,"max":1},"name":"chicken or vegetable stock","optional":false,"text":"1 litre of chicken or vegetable stock","unit":"litre"},{"amount":{"min":null,"max":null},"name":"Small bunch parsley","optional":false,"suffix":"leaves only and finely chopped","text":"Small bunch of parsley, leaves only and finely chopped"},{"amount":{"max":100,"min":100},"name":"butter","optional":false,"text":"100 g butter","unit":"g"},{"amount":{"max":100,"min":100},"name":"parmesan cheese","optional":false,"prefix":"grated","text":"100 g grated parmesan cheese","unit":"g"},{"name":"Truffle oil","optional":false,"suffix":"(optional)","text":"Truffle oil (optional)"}],"recipeSection":""}],"ingredientsTemplate":[{"ingredientsList":[{"amount":{"max":25,"min":25},"name":"dried porcini mushrooms","optional":false,"text":"25 g dried porcini mushrooms","unit":"g"},{"amount":{"max":150,"min":150},"name":"chestnut","optional":false,"suffix":"or field mushrooms, roughly chopped","text":"150 g chestnut or field mushrooms, roughly chopped","unit":"g"},{"amount":{"max":150,"min":150},"name":"oyster mushrooms","optional":false,"suffix":"roughly chopped","text":"150 g oyster mushrooms, roughly chopped","unit":"g"},{"amount":{"max":4,"min":4},"name":"olive oil","optional":false,"text":"4 tbsp olive oil","unit":"tbsp"},{"amount":{"max":1,"min":1},"name":"sized onion","optional":false,"prefix":"medium","suffix":"finely chopped","text":"1 medium sized onion, finely chopped"},{"amount":{"min":2,"max":2},"name":"garlic cloves","optional":false,"suffix":"minced","text":"2 cloves of garlic, minced"},{"amount":{"max":200,"min":200},"name":"arborio rice","optional":false,"text":"200 g arborio rice","unit":"g"},{"amount":{"max":250,"min":250},"name":"white wine","optional":false,"text":"250 ml white wine","unit":"ml"},{"amount":{"min":1,"max":1},"name":"chicken or vegetable stock","optional":false,"text":"1 litre of chicken or vegetable stock","unit":"litre"},{"amount":{"min":null,"max":null},"name":"Small bunch parsley","optional":false,"suffix":"leaves only and finely chopped","text":"Small bunch of parsley, leaves only and finely chopped"},{"amount":{"max":100,"min":100},"name":"butter","optional":false,"text":"100 g butter","unit":"g"},{"amount":{"max":100,"min":100},"name":"parmesan cheese","optional":false,"prefix":"grated","text":"100 g grated parmesan cheese","unit":"g"},{"name":"Truffle oil","optional":false,"suffix":"(optional)","text":"Truffle oil (optional)"}],"recipeSection":""}],"instructions":[{"description":"Soak the mushrooms in boiling water for 15-20 minutes. You need just enough water to cover the mushrooms."},{"description":"Roughly chop the chestnut and oyster mushrooms so they are 1-2cm cubed, or however chunky you prefer them."},{"description":"Fry in 1 tbsp olive oil and a knob of butter until golden brown. Set to one side until you’re ready to add them to the risotto."},{"description":"Fry the finely chopped onion in three tbsp of olive oil for about five minutes on a medium heat until soft but not browned."},{"description":"Add the garlic and fry for another minute."},{"description":"Add the rice and mix until nicely coated with the oil, onions and garlic."},{"description":"Add the wine, turn the heat up and stir continuously."},{"description":"Cook until fully absorbed and turn the heat back down to medium."},{"description":"Add the porcini water and stir again until fully absorbed."},{"description":"Add enough stock to just cover the rice, stir and repeat the process for about 10 minutes."},{"description":"Add the mushrooms and cook with the rice for five minutes - it should have absorbed the majority of the liquid but not be completely dry."},{"description":"You have the option to add a bit more stock – the most important thing is that the rice still has a bit of a bite but isn’t too crunchy."},{"description":"Add a knob of butter, 75g of Parmesan, and the parsley. Stir together and check the consistency. It should be wet but not sitting in liquid. Allow it to sit for a minute or two before serving."},{"description":"Serve in shallow bowls or plates. For those who like it extra cheesy, sprinkle the remainder of the Parmesan on top. For something extra special drizzle over some truffle oil."},{"description":"Vegans can easily substitute the butter for oil (although there is no need to add extra oil at the end of the recipe) and you can leave the cheese out too."}],"instructionsTemplate":[{"description":"Soak the mushrooms in boiling water for 15-20 minutes. You need just enough water to cover the mushrooms."},{"description":"Roughly chop the chestnut and oyster mushrooms so they are 1-2cm cubed, or however chunky you prefer them."},{"description":"Fry in 1 tbsp olive oil and a knob of butter until golden brown. Set to one side until you’re ready to add them to the risotto."},{"description":"Fry the finely chopped onion in three tbsp of olive oil for about five minutes on a medium heat until soft but not browned."},{"description":"Add the garlic and fry for another minute."},{"description":"Add the rice and mix until nicely coated with the oil, onions and garlic."},{"description":"Add the wine, turn the heat up and stir continuously."},{"description":"Cook until fully absorbed and turn the heat back down to medium."},{"description":"Add the porcini water and stir again until fully absorbed."},{"description":"Add enough stock to just cover the rice, stir and repeat the process for about 10 minutes."},{"description":"Add the mushrooms and cook with the rice for five minutes - it should have absorbed the majority of the liquid but not be completely dry."},{"description":"You have the option to add a bit more stock – the most important thing is that the rice still has a bit of a bite but isn’t too crunchy."},{"description":"Add a knob of butter, 75g of Parmesan, and the parsley. Stir together and check the consistency. It should be wet but not sitting in liquid. Allow it to sit for a minute or two before serving."},{"description":"Serve in shallow bowls or plates. For those who like it extra cheesy, sprinkle the remainder of the Parmesan on top. For something extra special drizzle over some truffle oil."},{"description":"Vegans can easily substitute the butter for oil (although there is no need to add extra oil at the end of the recipe) and you can leave the cheese out too."}],"isAppReady":false,"mealTypeIds":["easy","quick","midweek","dinner"],"serves":[],"suitableForDietIds":["meat-free","gluten-free","pescatarian"],"techniquesUsedIds":[],"timings":[{"durationInMins":{"max":20,"min":20},"qualifier":"prep-time","text":"Prep time: 20 mins"},{"durationInMins":{"max":30,"min":30},"qualifier":"cook-time","text":"Cook time: 30 mins"}],"title":"Risotto ai funghi porcini","utensilsAndApplianceIds":[],"byline":["Alice Staple"],"previewImage":{"url":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=1600&dpr=1&s=none","mediaId":"b9c696f5d94a3a6ab1320fc41af10f9037ce5a48","cropId":"","source":"PR","photographer":"","caption":"Alice Staple’s mushroom risotto.","mediaApiUri":"","width":2000,"height":1200,"templateUrl":"https://i.guim.co.uk/img/media/b9c696f5d94a3a6ab1320fc41af10f9037ce5a48/0_79_2362_1417/master/2362.jpg?width=#{width}&quality=#{quality}&dpr=1&s=none"},"lastModifiedDate":"2024-09-09T11:49:07.000Z","publishedDate":"2024-09-09T11:49:10.000Z"}`;

const originalHash = `7mrlrJ8I6gXDkhLqA0Yuxh_uKWNMawa3oyqP4ZHgYv0`;

describe('convertToRecipeV2', () => {
	it('should convert a v3 recipe to v2 by removing the template fields', () => {
		const v2 = convertToRecipeV2(raw_json_content_v3);

		expect(v2).toEqual(raw_json_content_v2);
		expect(calculateChecksum(v2)).toEqual(originalHash);
	});
	it('should convert a not alter a v2 recipe', () => {
		const v2 = convertToRecipeV2(raw_json_content_v2);

		expect(v2).toEqual(raw_json_content_v2);
		expect(calculateChecksum(v2)).toEqual(originalHash);
	});
});
